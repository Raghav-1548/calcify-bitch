<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calcify B!tch</title>
  <style>
    body { font-family: 'Inter', sans-serif; background: #f6f8fb; margin: 0; padding: 24px; color: #222; }
    .container { max-width: 900px; margin: auto; background: #fff; padding: 24px; border-radius: 12px; box-shadow: 0 4px 16px rgba(0,0,0,0.08); }
    h2 { text-align: center; margin-bottom: 20px; }
    select, input[type="number"], input[type="text"] { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 6px; }
    button { padding: 8px 14px; border: none; border-radius: 8px; cursor: pointer; }
    button.add { background: #007bff; color: white; }
    button.calc { background: #28a745; color: white; float: right; }
    button.delete { background: #dc3545; color: white; padding: 4px 8px; font-size: 12px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border-bottom: 1px solid #eee; padding: 8px; text-align: left; }
    th:last-child, td:last-child { text-align: center; }
    .result { margin-top: 24px; background: #f9fafc; padding: 12px; border-radius: 8px; }
    .row { display: flex; gap: 12px; margin-bottom: 12px; }
    .col { flex: 1; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Calcify B!tch</h2>
    <div class="row">
      <div class="col">
        <select id="personSelect">
          <option value="Karthik">Karthik</option>
          <option value="Bhavana">Bhavana</option>
          <option value="Shrinivas">Shrinivas</option>
          <option value="Hari">Hari</option>
          <option value="Bhagyaa">Bhagyaa</option>
        </select>
      </div>
      <div class="col">
        <input type="text" id="purposeInput" placeholder="Purpose (e.g. Lunch, Tickets, etc.)" />
      </div>
      <div class="col">
        <input type="number" id="amountInput" placeholder="Amount (₹)" min="0" />
      </div>
    </div>
    <button class="add" onclick="addExpense()">Add Expense</button>
    <table id="expenseTable">
      <thead>
        <tr><th>Person</th><th>Purpose</th><th>Amount (₹)</th><th>Action</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="row" style="margin-top:10px;">
      <div class="col">
        <button class="calc" onclick="calculate('proportional')">Calculate Proportional</button>
      </div>
      <div class="col">
        <button class="calc" onclick="calculate('equal')">Calculate Equal Split</button>
      </div>
    </div>
    <div class="result" id="result"></div>
  </div>
  <script>
    const expenses = [];
    function addExpense() {
      const person = document.getElementById('personSelect').value;
      const purpose = document.getElementById('purposeInput').value.trim();
      const amount = parseFloat(document.getElementById('amountInput').value);
      if (!amount || amount <= 0) return alert('Enter a valid amount');
      expenses.push({ person, purpose: purpose || 'N/A', amount });
      renderTable();
      document.getElementById('purposeInput').value = '';
      document.getElementById('amountInput').value = '';
    }
    function renderTable() {
      const tbody = document.querySelector('#expenseTable tbody');
      tbody.innerHTML = expenses.map((e, i) => `<tr><td>${e.person}</td><td>${e.purpose}</td><td>₹${e.amount.toFixed(2)}</td><td><button class='delete' onclick='deleteExpense(${i})'>Delete</button></td></tr>`).join('');
    }
    function deleteExpense(index) {
      expenses.splice(index, 1);
      renderTable();
      document.getElementById('result').innerHTML = '';
    }
    function calculate(type) {
      if (expenses.length === 0) return alert('No expenses added');
      const members = ['Karthik','Bhavana','Shrinivas','Hari','Bhagyaa'];
      const totals = {};
      members.forEach(m => totals[m] = 0);
      expenses.forEach(e => totals[e.person] += e.amount);
      const total = Object.values(totals).reduce((a,b)=>a+b,0);
      const share = total / members.length;
      const balances = members.map(m=>({name:m,balance:+(totals[m]-share).toFixed(2)}));
      const creditors = balances.filter(b=>b.balance>0).sort((a,b)=>b.balance-a.balance);
      const debtors = balances.filter(b=>b.balance<0).sort((a,b)=>a.balance-b.balance);
      const settlements=[];
      if(type==='proportional'){
        let i=0,j=0;
        while(i<creditors.length && j<debtors.length){
          const c=creditors[i];
          const d=debtors[j];
          const amt=Math.min(c.balance,Math.abs(d.balance));
          settlements.push({from:d.name,to:c.name,amount:amt});
          c.balance-=amt;
          d.balance+=amt;
          if(Math.abs(c.balance)<0.01)i++;
          if(Math.abs(d.balance)<0.01)j++;
        }
      } else {
        const creditorNames=creditors.map(c=>c.name);
        debtors.forEach(d=>{
          const split=d.balance/creditorNames.length;
          creditorNames.forEach(cn=>{
            settlements.push({from:d.name,to:cn,amount:-split});
          });
        });
        let creditorTotals={};
        creditors.forEach(c=>creditorTotals[c.name]=c.balance);
        settlements.forEach(s=>{
          creditorTotals[s.to]-=s.amount;
        });
        const overUnder=creditors.map(c=>({from:creditors[0].name,to:c.name,amount:creditorTotals[c.name]})).filter(x=>Math.abs(x.amount)>0.01);
        settlements.push(...overUnder);
      }
      let resultHTML=`<strong>Total:</strong> ₹${total.toFixed(2)}<br><strong>Each should pay:</strong> ₹${share.toFixed(2)}<br><br><strong>Breakdown:</strong><br>`;
      resultHTML+=Object.entries(totals).map(([name,amt])=>`${name}: ₹${amt.toFixed(2)}<br>`).join('');
      resultHTML+='<br><strong>Who pays whom:</strong><br>';
      if(settlements.length===0){resultHTML+='All settled!';}
      else{
        settlements.forEach(s=>{
          if(s.amount>0)resultHTML+=`${s.from} should pay ${s.to}: ₹${s.amount.toFixed(2)}<br>`;
        });
      }
      document.getElementById('result').innerHTML=resultHTML;
    }
  </script>
</body>
</html>
